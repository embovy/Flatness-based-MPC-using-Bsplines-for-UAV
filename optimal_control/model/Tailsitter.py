import numpy as np
import casadi as cd
from matplotlib import pyplot as plt
from mpl_toolkits.mplot3d.art3d import Poly3DCollection

from tools.tool_functions import Rotx, Roty, Rotz
from tools.Env import Env
import os 

g = 9.81

class TailsitterModel(Env):
    def __init__(self, N, m=2.5, Ixx=0.0084, Iyy=0.0118, Izz=0.0199, L=0.2, kL=0.6142, kD=2.6656e-04, k1=0.0429, k2=0.0146, k3=0.0023):
        # Define tailsitter model parameters
        self.m = m
        self.Ixx, self.Iyy, self.Izz = Ixx, Iyy, Izz
        self.L = L
        self.kL, self.kD = kL, kD
        self.k1, self.k2, self.k3 = k1, k2, k3

        self.flat_order = 4

        self.state_space_shape = (12, N)
        self.action_space_shape = (4, N-1)


    def ForwardDynamics(self, x, u):
        """
        Dynamics model with state x and input u, all n steps are considered

        Args:
            x (array_like: matrix of column vectors): state   x = [x, y, z, psi, phi, theta, xdot, ydot, zdot, psidot_b, phidot_b, thetadot_b].T    -> shape(12,n)
            u (array_like: matrix of column vectors): control u = [T1, T2, delta1, delta2].T                                                      -> shape(4,n)

        Returns:
            dx (array_like: matrix of column vectors)   -> shape(12,n)
        """

        m = self.m
        Ixx, Iyy, Izz = self.Ixx, self.Iyy, self.Izz
        L = self.L
        kL, kD = self.kL, self.kD
        k1, k2, k3 = self.k1, self.k2, self.k3
        
        try:
            rows, columns = np.shape(x)
        except:
            x = x[:, np.newaxis]
            rows, columns = np.shape(x)

        try:
            _, __ = np.shape(u)
        except:
            u = u[:, np.newaxis]
        
        dx = np.zeros((12, columns))

        dx[0:3,:] = x[6:9,:]

        dx[3,:] = (np.cos(x[5,:])*x[11,:] - np.sin(x[5,:])*x[9,:]) / (np.cos(x[4,:]) + 1e-4)
        dx[4,:] = np.cos(x[5,:])*x[9,:] + np.sin(x[5,:])*x[11,:]
        dx[5,:] = (-np.sin(x[4,:])*np.cos(x[5,:])*x[11,:] + np.sin(x[4,:])*np.sin(x[5,:])*x[9,:] + x[10,:]*np.cos(x[4,:])) / (np.cos(x[4,:]) + 1e-4)

        dx[6,:] = (np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*((u[0,:]+u[1,:])-kD*((np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[7,:]-np.cos(x[4,:])*np.sin(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2))/m-(np.cos(x[3,:])*np.sin(x[5,:])+np.sin(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*kL*((np.cos(x[3,:])*np.sin(x[5,:])+np.sin(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.sin(x[5,:])-np.cos(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*x[7,:]+np.cos(x[4,:])*np.cos(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2)/m
        dx[7,:] = (np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*((u[0,:]+u[1,:])-kD*((np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[7,:]-np.cos(x[4,:])*np.sin(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2))/m-(np.sin(x[3,:])*np.sin(x[5,:])-np.cos(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*kL*((np.cos(x[3,:])*np.sin(x[5,:])+np.sin(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.sin(x[5,:])-np.cos(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*x[7,:]+np.cos(x[4,:])*np.cos(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2)/m
        dx[8,:] = -np.cos(x[4,:])*np.sin(x[5,:])*((u[0,:]+u[1,:])-kD*((np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[7,:]-np.cos(x[4,:])*np.sin(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2))/m-np.cos(x[4,:])*np.cos(x[5,:])*kL*((np.cos(x[3,:])*np.sin(x[5,:])+np.sin(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.sin(x[5,:])-np.cos(x[3,:])*np.sin(x[4,:])*np.cos(x[5,:]))*x[7,:]+np.cos(x[4,:])*np.cos(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2)/m-g

        dx[9,:] = (k1*((np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[7,:]-np.cos(x[4,:])*np.sin(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2)*(u[3,:]-u[2,:])+Iyy*x[10,:]*x[11,:]-Izz*x[10,:]*x[11,:])/Ixx
        dx[10,:] = (k2*((np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[7,:]-np.cos(x[4,:])*np.sin(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2)*(u[3,:]+u[2,:])-Ixx*x[9,:]*x[11,:]+Izz*x[9,:]*x[11,:])/Iyy
        dx[11,:] = (k3*((np.cos(x[3,:])*np.cos(x[5,:])-np.sin(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[6,:]+(np.sin(x[3,:])*np.cos(x[5,:])+np.cos(x[3,:])*np.sin(x[4,:])*np.sin(x[5,:]))*x[7,:]-np.cos(x[4,:])*np.sin(x[5,:])*x[8,:])*(x[6,:]**2+x[7,:]**2+x[8,:]**2)**(1/2)*(u[3,:]-u[2,:])+u[1,:]*L-u[0,:]*L+Ixx*x[9,:]*x[10,:]-Iyy*x[9,:]*x[10,:])/Izz


        return dx

    def ForwardDynamics1D(self, x, u):
        """
        Dynamics model with state x and input u, only 1 step considered

        Args:
            x (array_like): state   x = [x, y, z, psi, phi, theta, xdot, ydot, zdot, psidot_b, phidot_b, thetadot_b].T    -> shape(12,1)
            u (array_like): control u = [T1, T2, delta1, delta2].T                                                      -> shape(4,1)

        Returns:
            xdot (SX casadi)   -> shape(12,1)
        """

        m = self.m
        Ixx, Iyy, Izz = self.Ixx, self.Iyy, self.Izz
        L = self.L
        kL, kD = self.kL, self.kD
        k1, k2, k3 = self.k1, self.k2, self.k3
        
        dx0 = x[6]
        dx1 = x[7]
        dx2 = x[8]

        dx3 = (np.cos(x[5])*x[11] - np.sin(x[5])*x[9]) / (np.cos(x[4]) + 1e-9)
        dx4 = np.cos(x[5])*x[9] + np.sin(x[5])*x[11]
        dx5 = (-np.sin(x[4])*np.cos(x[5])*x[11] + np.sin(x[4])*np.sin(x[5])*x[9] + x[10]*np.cos(x[4])) / (np.cos(x[4]) + 1e-9)

        dx6 = (np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*((u[0]+u[1])-kD*((np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*x[6]+(np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*x[7]-np.cos(x[4])*np.sin(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2))/m-(np.cos(x[3])*np.sin(x[5])+np.sin(x[3])*np.sin(x[4])*np.cos(x[5]))*kL*((np.cos(x[3])*np.sin(x[5])+np.sin(x[3])*np.sin(x[4])*np.cos(x[5]))*x[6]+(np.sin(x[3])*np.sin(x[5])-np.cos(x[3])*np.sin(x[4])*np.cos(x[5]))*x[7]+np.cos(x[4])*np.cos(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2)/m
        dx7 = (np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*((u[0]+u[1])-kD*((np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*x[6]+(np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*x[7]-np.cos(x[4])*np.sin(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2))/m-(np.sin(x[3])*np.sin(x[5])-np.cos(x[3])*np.sin(x[4])*np.cos(x[5]))*kL*((np.cos(x[3])*np.sin(x[5])+np.sin(x[3])*np.sin(x[4])*np.cos(x[5]))*x[6]+(np.sin(x[3])*np.sin(x[5])-np.cos(x[3])*np.sin(x[4])*np.cos(x[5]))*x[7]+np.cos(x[4])*np.cos(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2)/m
        dx8 = -np.cos(x[4])*np.sin(x[5])*((u[0]+u[1])-kD*((np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*x[6]+(np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*x[7]-np.cos(x[4])*np.sin(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2))/m-np.cos(x[4])*np.cos(x[5])*kL*((np.cos(x[3])*np.sin(x[5])+np.sin(x[3])*np.sin(x[4])*np.cos(x[5]))*x[6]+(np.sin(x[3])*np.sin(x[5])-np.cos(x[3])*np.sin(x[4])*np.cos(x[5]))*x[7]+np.cos(x[4])*np.cos(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2)/m-g

        dx9 = (k1*((np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*x[6]+(np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*x[7]-np.cos(x[4])*np.sin(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2)*(u[3]-u[2])+Iyy*x[10]*x[11]-Izz*x[10]*x[11])/Ixx
        dx10 = (k2*((np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*x[6]+(np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*x[7]-np.cos(x[4])*np.sin(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2)*(u[3]+u[2])-Ixx*x[9]*x[11]+Izz*x[9]*x[11])/Iyy
        dx11 = (k3*((np.cos(x[3])*np.cos(x[5])-np.sin(x[3])*np.sin(x[4])*np.sin(x[5]))*x[6]+(np.sin(x[3])*np.cos(x[5])+np.cos(x[3])*np.sin(x[4])*np.sin(x[5]))*x[7]-np.cos(x[4])*np.sin(x[5])*x[8])*(x[6]**2+x[7]**2+x[8]**2)**(1/2)*(u[3]-u[2])+u[1]*L-u[0]*L+Ixx*x[9]*x[10]-Iyy*x[9]*x[10])/Izz


        xdot = cd.vertcat(dx0, dx1, dx2, dx3, dx4, dx5, dx6, dx7, dx8, dx9, dx10, dx11)

        return xdot

    def InverseDynamics(self, y, dy, ddy, dddy, ddddy):
        """
        Calculates the inverse dynamics given the flat coordinates y for a complete trajectory, all n steps are considered

        Args:
            y (array_like: matrix of column vectors):       flat output   y = [x, y, z, psi].T                      -> shape (4, n)
            dy (array_like: matrix of column vectors):      flat output   dy = [dx, dy, dz, dpsi].T                 -> shape (4, n)
            ddy (array_like: matrix of column vectors):     flat output   ddy = [ddx, ddy, ddz, ddpsi].T            -> shape (4, n)
            dddy (array_like: matrix of column vectors):    flat output   dddy = [dddx, dddy, dddz, dddpsi].T       -> shape (4, n)
            ddddy (array_like: matrix of column vectors):   flat output   ddddy = [ddddx, ddddy, ddddz, ddddpsi].T  -> shape (4, n)
        
        Returns:
            x (array_like: matrix of column vectors): state     x = [x, y, z, psi, phi, theta, xdot, ydot, zdot, psidot_b, phidot_b, thetadot_b].T  -> shape (12, n)
            u (array_like: matrix of column vectors): control   u = [T1, T2, delta1, delta2].T                                                      -> shape (4, n) 
        """
        m = self.m
        Ixx, Iyy, Izz = self.Ixx, self.Iyy, self.Izz
        L = self.L
        kL, kD = self.kL, self.kD
        k1, k2, k3 = self.k1, self.k2, self.k3

        try:
            _, columns = np.shape(y)
        except:
            y = y[:, np.newaxis]
            _, columns = np.shape(y)

        x = np.zeros((12, columns))
        u = np.zeros((4, columns))
        
        x[0:4,:] = y
        x[4,:] = -np.arctan2(-np.sin(y[3,:])*m*ddy[0,:]+np.cos(y[3,:])*m*ddy[1,:],m*ddy[2,:]+m*g)
        x[5,:] = np.arctan2((-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])-np.cos(y[3,:])**2*dy[0,:]+dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2)-m*((1-np.cos(y[3,:])**2)*ddy[0,:]**2-2*np.sin(y[3,:])*ddy[0,:]*np.cos(y[3,:])*ddy[1,:]+np.cos(y[3,:])**2*ddy[1,:]**2+(ddy[2,:]+g)**2))/(1e-4 + (1-np.cos(y[3,:])**2)*ddy[0,:]**2-2*np.sin(y[3,:])*ddy[0,:]*np.cos(y[3,:])*ddy[1,:]+np.cos(y[3,:])**2*ddy[1,:]**2+(ddy[2,:]+g)**2)**(1/2),m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))

        bool = 1-2*(x[5,:] < -np.pi/2)

        x[6:9,:] = dy[0:3,:]

        x[9,:] = -(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))
        x[10,:] = -(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(dy[3,:])/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+((-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)/(1e-4 + 1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)
        x[11,:] = (dy[3,:])/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))

        x[9,:] = bool*x[9,:]
        x[11,:] = bool*x[11,:]

        dox = -(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(ddy[3,:])/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))-((-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**3-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**2)
        doy = -(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(dy[3,:])/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(dy[3,:])*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(dy[3,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(ddy[3,:])/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(((1/4)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))**2/((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(3/2)-(1/2)*m*(2*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))**2+2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((ddy[3,:])*np.cos(y[3,:])*(ddy[0,:])-(dy[3,:])**2*np.sin(y[3,:])*(ddy[0,:])+2*(dy[3,:])*np.cos(y[3,:])*(dddy[0,:])+np.sin(y[3,:])*(ddddy[0,:])+(ddy[3,:])*np.sin(y[3,:])*(ddy[1,:])+(dy[3,:])**2*np.cos(y[3,:])*(ddy[1,:])+2*(dy[3,:])*np.sin(y[3,:])*(dddy[1,:])-np.cos(y[3,:])*(ddddy[1,:]))+2*(dddy[2,:])**2+2*(ddy[2,:]+g)*(ddddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m**2*(dddy[2,:])**2/((m*(ddy[2,:])+m*g)**3*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(ddddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(3/4)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)**2/((m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(5/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2-8*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2+6*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**4-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(ddy[3,:])*np.cos(y[3,:])*(dy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*(dy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*(ddy[0,:])-np.sin(y[3,:])*(dddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*(dy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*(dy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])+np.cos(y[3,:])*(dddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(3/4)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)**2/(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(5/2)-(ddy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)-(1/2)*(dy[2,:])*(2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2-8*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2+6*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**4-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(dddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/4)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))**2/((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(3/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(ddy[0,:])**2+2*(dy[0,:])*(dddy[0,:])+2*(ddy[1,:])**2+2*(dy[1,:])*(dddy[1,:])+2*(ddy[2,:])**2+2*(dy[2,:])*(dddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))-2*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2+2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((ddy[3,:])*np.cos(y[3,:])*(ddy[1,:])-(dy[3,:])**2*np.sin(y[3,:])*(ddy[1,:])+2*(dy[3,:])*np.cos(y[3,:])*(dddy[1,:])+np.sin(y[3,:])*(ddddy[1,:])+(ddddy[0,:])*np.cos(y[3,:])-2*(dddy[0,:])*(dy[3,:])*np.sin(y[3,:])-(ddy[0,:])*(ddy[3,:])*np.sin(y[3,:])-(ddy[0,:])*(dy[3,:])**2*np.cos(y[3,:]))+kL*(-(ddy[3,:])*np.sin(y[3,:])*(dy[0,:])-(dy[3,:])**2*np.cos(y[3,:])*(dy[0,:])-2*(ddy[0,:])*(dy[3,:])*np.sin(y[3,:])+(dddy[0,:])*np.cos(y[3,:])+(ddy[3,:])*np.cos(y[3,:])*(dy[1,:])-(dy[3,:])**2*np.sin(y[3,:])*(dy[1,:])+2*(dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/4)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))**2/((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(3/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(ddy[0,:])**2+2*(dy[0,:])*(dddy[0,:])+2*(ddy[1,:])**2+2*(dy[1,:])*(dddy[1,:])+2*(ddy[2,:])**2+2*(dy[2,:])*(dddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)/(1e-4 + 1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)-((-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + 1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**2
        doz = -(1/2)*(dy[3,:])*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[3,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(ddy[3,:])/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+(1/2)*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**3-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**2)

        dox = bool*dox
        doz = bool*doz

        vx = 1/(1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])-(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)
        vy = ((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])*dy[2,:]-(np.sin(y[3,:])*dy[0,:]-np.cos(y[3,:])*dy[1,:])*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)
        vz = (-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])+1/(1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)

        vx = bool*vx
        vz = bool*vz

        oIox = (Izz-Iyy)*x[10,:]*x[11,:]
        oIoy = (Ixx-Izz)*x[9,:]*x[11,:]
        oIoz = (Iyy-Ixx)*x[9,:]*x[10,:]

        taux = Ixx*dox + oIox
        tauy = Iyy*doy + oIoy
        tauz = Izz*doz + oIoz

        v = np.sqrt(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)

        T = (-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kD*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2)*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2))*(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)+(m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kD*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2)*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:]))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)

        T = bool*T

        u[0,:] = .5*T + .5/L*(k3*taux/k1-tauz)
        u[1,:] = .5*T - .5/L*(k3*taux/k1-tauz)
        u[2,:] = .5*1/(vx+1e-4)/(v+1e-4)*(tauy/k2-taux/k1)
        u[3,:] = .5*1/(vx+1e-4)/(v+1e-4)*(taux/k1+tauy/k2)

        v = np.array([vx, vy, vz])

        return x, u, v
    
    def InverseDynamicsArray(self, Y):
        """
        Calculates the inverse dynamics given the flat coordinates y for a complete trajectory, all n steps are considered

        Args:
            Y (array_like): [y, dy, ddy, dddy, ddddy]

            constisting of:

            y (array_like: matrix of column vectors):       flat output   y = [x, y, z, psi]                        -> shape (n, 4)
            dy (array_like: matrix of column vectors):      flat output   dy = [dx, dy, dz, dpsi]                   -> shape (n, 4)
            ddy (array_like: matrix of column vectors):     flat output   ddy = [ddx, ddy, ddz, ddpsi]              -> shape (n, 4)
            dddy (array_like: matrix of column vectors):    flat output   dddy = [dddx, dddy, dddz, dddpsi]         -> shape (n, 4)
            ddddy (array_like: matrix of column vectors):   flat output   ddddy = [ddddx, ddddy, ddddz, ddddpsi]    -> shape (n, 4)
        
        Returns:
            x (array_like: matrix of column vectors): state     x = [x, y, z, psi, phi, theta, xdot, ydot, zdot, psidot_b, phidot_b, thetadot_b].T  -> shape (12, n)
            u (array_like: matrix of column vectors): control   u = [T1, T2, delta1, delta2].T                                                      -> shape (4, n) 
        """
        m = self.m
        Ixx, Iyy, Izz = self.Ixx, self.Iyy, self.Izz
        L = self.L
        kL, kD = self.kL, self.kD
        k1, k2, k3 = self.k1, self.k2, self.k3

        y, dy, ddy, dddy, ddddy = cd.horzsplit(Y, [0, 4, 8, 12, 16, 20])
        y, dy, ddy, dddy, ddddy = y.T, dy.T, ddy.T, dddy.T, ddddy.T

        try:
            rows, _ = np.shape(Y)
        except:
            raise Exception("Wrong input dimension of Y; need (N, 20)")
       
        x0123 = y
        x4 = -np.arctan2(-np.sin(y[3,:])*m*ddy[0,:]+np.cos(y[3,:])*m*ddy[1,:],m*ddy[2,:]+m*g)
        x5 = np.arctan2((-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])-np.cos(y[3,:])**2*dy[0,:]+dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2)-m*((1-np.cos(y[3,:])**2)*ddy[0,:]**2-2*np.sin(y[3,:])*ddy[0,:]*np.cos(y[3,:])*ddy[1,:]+np.cos(y[3,:])**2*ddy[1,:]**2+(ddy[2,:]+g)**2))/(1e-4 + (1-np.cos(y[3,:])**2)*ddy[0,:]**2-2*np.sin(y[3,:])*ddy[0,:]*np.cos(y[3,:])*ddy[1,:]+np.cos(y[3,:])**2*ddy[1,:]**2+(ddy[2,:]+g)**2)**(1/2),m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))

        bool = 1-2*(x5 < -np.pi/2)

        x678 = dy[0:3,:]

        x9 = -(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))
        x10 = -(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(dy[3,:])/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+((-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)/(1e-4 + 1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)
        x11 = (dy[3,:])/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))

        x9 = bool*x9
        x11 = bool*x11

        dox = -(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(dy[3,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(ddy[3,:])/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))-((-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**3-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**2)
        doy = -(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(dy[3,:])/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(dy[3,:])*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(dy[3,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(ddy[3,:])/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(((1/4)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))**2/((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(3/2)-(1/2)*m*(2*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))**2+2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((ddy[3,:])*np.cos(y[3,:])*(ddy[0,:])-(dy[3,:])**2*np.sin(y[3,:])*(ddy[0,:])+2*(dy[3,:])*np.cos(y[3,:])*(dddy[0,:])+np.sin(y[3,:])*(ddddy[0,:])+(ddy[3,:])*np.sin(y[3,:])*(ddy[1,:])+(dy[3,:])**2*np.cos(y[3,:])*(ddy[1,:])+2*(dy[3,:])*np.sin(y[3,:])*(dddy[1,:])-np.cos(y[3,:])*(ddddy[1,:]))+2*(dddy[2,:])**2+2*(ddy[2,:]+g)*(ddddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m**2*(dddy[2,:])**2/((m*(ddy[2,:])+m*g)**3*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(ddddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(3/4)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)**2/((m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(5/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2-8*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2+6*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**4-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(ddy[3,:])*np.cos(y[3,:])*(dy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*(dy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*(ddy[0,:])-np.sin(y[3,:])*(dddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*(dy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*(dy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])+np.cos(y[3,:])*(dddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(3/4)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)**2/(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(5/2)-(ddy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)-(1/2)*(dy[2,:])*(2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2-8*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2+6*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**4-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(dddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/4)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))**2/((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(3/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(ddy[0,:])**2+2*(dy[0,:])*(dddy[0,:])+2*(ddy[1,:])**2+2*(dy[1,:])*(dddy[1,:])+2*(ddy[2,:])**2+2*(dy[2,:])*(dddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))-2*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2+2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((ddy[3,:])*np.cos(y[3,:])*(ddy[1,:])-(dy[3,:])**2*np.sin(y[3,:])*(ddy[1,:])+2*(dy[3,:])*np.cos(y[3,:])*(dddy[1,:])+np.sin(y[3,:])*(ddddy[1,:])+(ddddy[0,:])*np.cos(y[3,:])-2*(dddy[0,:])*(dy[3,:])*np.sin(y[3,:])-(ddy[0,:])*(ddy[3,:])*np.sin(y[3,:])-(ddy[0,:])*(dy[3,:])**2*np.cos(y[3,:]))+kL*(-(ddy[3,:])*np.sin(y[3,:])*(dy[0,:])-(dy[3,:])**2*np.cos(y[3,:])*(dy[0,:])-2*(ddy[0,:])*(dy[3,:])*np.sin(y[3,:])+(dddy[0,:])*np.cos(y[3,:])+(ddy[3,:])*np.cos(y[3,:])*(dy[1,:])-(dy[3,:])**2*np.sin(y[3,:])*(dy[1,:])+2*(dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/4)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))**2/((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(3/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(ddy[0,:])**2+2*(dy[0,:])*(dddy[0,:])+2*(ddy[1,:])**2+2*(dy[1,:])*(dddy[1,:])+2*(ddy[2,:])**2+2*(dy[2,:])*(dddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)/(1e-4 + 1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)-((-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + 1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**2
        doz = -(1/2)*(dy[3,:])*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[3,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(ddy[3,:])/(1e-4 + (1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+(1/2)*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(-(1/2)*m*(2*(np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))*((dy[3,:])*np.cos(y[3,:])*(ddy[0,:])+np.sin(y[3,:])*(dddy[0,:])+(dy[3,:])*np.sin(y[3,:])*(ddy[1,:])-np.cos(y[3,:])*(dddy[1,:]))+2*(ddy[2,:]+g)*(dddy[2,:]))/(1e-4 + (np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*m*(dddy[2,:])/(1e-4 + (m*(ddy[2,:])+m*g)**2*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2))+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*(dy[0,:])-np.sin(y[3,:])*(ddy[0,:])-(dy[3,:])*np.sin(y[3,:])*(dy[1,:])+np.cos(y[3,:])*(ddy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))-(1/2)*(dy[2,:])*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(3/2)+(ddy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)-(1/2)*kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2-2*(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2*(m*((dy[3,:])*np.cos(y[3,:])*(ddy[1,:])+np.sin(y[3,:])*(dddy[1,:])+(dddy[0,:])*np.cos(y[3,:])-(ddy[0,:])*(dy[3,:])*np.sin(y[3,:]))+kL*(-(dy[3,:])*np.sin(y[3,:])*(dy[0,:])+(ddy[0,:])*np.cos(y[3,:])+(dy[3,:])*np.cos(y[3,:])*(dy[1,:])+np.sin(y[3,:])*(ddy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2)+(1/2)*kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*(2*(dy[0,:])*(ddy[0,:])+2*(dy[1,:])*(ddy[1,:])+2*(dy[2,:])*(ddy[2,:]))/(1e-4 + (dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(3/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))-(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(ddy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])+(dy[3,:])**2*np.sin(y[3,:])*m*(ddy[0,:])-2*(dy[3,:])*np.cos(y[3,:])*m*(dddy[0,:])-np.sin(y[3,:])*m*(ddddy[0,:])-(ddy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])-(dy[3,:])**2*np.cos(y[3,:])*m*(ddy[1,:])-2*(dy[3,:])*np.sin(y[3,:])*m*(dddy[1,:])+np.cos(y[3,:])*m*(ddddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-2*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2+2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m**2*(dddy[2,:])**2/(1e-4 + m*(ddy[2,:])+m*g)**3-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(ddddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2))+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*((-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)-(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**2)*(2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-(dy[3,:])*np.cos(y[3,:])*m*(ddy[0,:])-np.sin(y[3,:])*m*(dddy[0,:])-(dy[3,:])*np.sin(y[3,:])*m*(ddy[1,:])+np.cos(y[3,:])*m*(dddy[1,:]))/(1e-4 + m*(ddy[2,:])+m*g)**2-2*(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2*m*(dddy[2,:])/(1e-4 + m*(ddy[2,:])+m*g)**3)/(1e-4 + (m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))*(1+(-m*((np.sin(y[3,:])*(ddy[0,:])-np.cos(y[3,:])*(ddy[1,:]))**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))*(-np.sin(y[3,:])*(dy[0,:])+np.cos(y[3,:])*(dy[1,:]))/(1e-4 + (m*(ddy[2,:])+m*g)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))+(dy[2,:])/(1e-4 + 1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**(1/2))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*(ddy[1,:])+(ddy[0,:])*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*(dy[0,:])+np.sin(y[3,:])*(dy[1,:]))*((dy[0,:])**2+(dy[1,:])**2+(dy[2,:])**2)**(1/2))**2)**(1/2)*(1+(-np.sin(y[3,:])*m*(ddy[0,:])+np.cos(y[3,:])*m*(ddy[1,:]))**2/(1e-4 + m*(ddy[2,:])+m*g)**2)**2)

        dox = bool*dox
        doz = bool*doz

        vx = 1/(1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])-(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)
        vy = ((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])*dy[2,:]-(np.sin(y[3,:])*dy[0,:]-np.cos(y[3,:])*dy[1,:])*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)
        vz = (-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])+1/(1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)

        vx = bool*vx
        vz = bool*vz

        oIox = (Izz-Iyy)*x10*x11
        oIoy = (Ixx-Izz)*x9*x11
        oIoz = (Iyy-Ixx)*x9*x10

        taux = Ixx*dox + oIox
        tauy = Iyy*doy + oIoy
        tauz = Izz*doz + oIoz

        v = np.sqrt(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)

        T = (-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kD*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2)*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2))*(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)+(m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kD*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2)*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:]))/(1e-4 + 1+(-m*((np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)-kL*((-dy[1,:]*np.cos(y[3,:])*np.sin(y[3,:])+np.sin(y[3,:])**2*dy[0,:])*ddy[0,:]+(dy[1,:]*np.cos(y[3,:])**2-np.cos(y[3,:])*np.sin(y[3,:])*dy[0,:])*ddy[1,:]+dy[2,:]*(ddy[2,:]+g))/(1e-4 + (np.sin(y[3,:])*ddy[0,:]-np.cos(y[3,:])*ddy[1,:])**2+(ddy[2,:]+g)**2)**(1/2)*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2/(1e-4 + m*(np.sin(y[3,:])*ddy[1,:]+ddy[0,:]*np.cos(y[3,:]))+kL*(np.cos(y[3,:])*dy[0,:]+np.sin(y[3,:])*dy[1,:])*(dy[0,:]**2+dy[1,:]**2+dy[2,:]**2)**(1/2))**2)**(1/2)

        T = bool*T

        u0 = .5*T + .5/L*(k3*taux/k1-tauz)
        u1 = .5*T - .5/L*(k3*taux/k1-tauz)
        u2 = .5*1/(vx+1e-4)/(v+1e-4)*(tauy/k2-taux/k1)
        u3 = .5*1/(vx+1e-4)/(v+1e-4)*(taux/k1+tauy/k2)

        x = cd.vertcat(x0123, x4, x5, x678, x9, x10, x11)
        u = cd.vertcat(u0, u1, u2, u3)

        return x.T, u.T

    @property
    def nx(self):
        return self.state_space_shape[0]

    @property
    def nu(self):
        return self.action_space_shape[0]


def plot_trajectory(X, title=None, ax=None, control_points=None, plot=True, fig=False, B=2, H=3, reduc=50, endpoint=True, aspect=None, xlim=None, ylim=None, zlim=None, obstacles=None, save=False):
    """
    Args:
        X (array_like: matrix of column vectors):               state   X = [x, y, z, psi, phi, theta, xdot, ydot, zdot, psidot_b, phidot_b, thetadot_b].T    -> shape(12,n)
        control_points (array_like: matrix of column vectors):  CP's    Y = [x, y, z, psi].T   -> shape(4,n)
        title (string): title of the plot
        B (float): base length of the triangle
        H (float): heigt of the triangle
        reduc (int): number of time points between two consecutive triangles    
    """
    X = np.array(X)
    if np.shape(X)[0] != 12:
        raise Exception("Wrong dimensions of state matrix X! Needs to be (12,n)")
    # Points of triangle as column vectors
    tri = np.array([[-H/3, -H/3, 2/3*H], [B/2, -B/2, 0], [0, 0, 0]])

    if (ax is None):
        fig = plt.figure()
        ax = fig.add_subplot(111, projection='3d')
        ax.set_xlabel('X')
        ax.set_ylabel('Y')
        ax.set_zlabel('Z')

        if xlim is not None:
            ax.set_xlim(xlim)
        if ylim is not None:
            ax.set_ylim(ylim)
        if zlim is not None:
            ax.set_zlim(zlim)        
        if (title is not None):
            ax.set_title(title)
                    
    for i in range(len(X[0,:])):
        if i%reduc == 0 or i == (len(X[0,:])-1)*(endpoint):
            state = X[:,i]
            x, y, z = state[0], state[1], state[2]
            psi, phi, theta = state[3], state[4], state[5]
            #print(psi, phi, theta)

            R = np.dot(Rotz(psi) ,np.dot(Rotx(phi) ,Roty(theta)))

            # Point as column vector
            traj_point = np.array([[x], [y], [z]])
            tri_rot = np.dot(R, tri) + np.tile(traj_point, (1,3))

            # Points of triangle as row vectors
            tri_rot = tri_rot.T

            verts = [list(tuple(_) for _ in tri_rot)]
            ax.add_collection3d(Poly3DCollection(verts, color='y', alpha=0.7))
            ax.scatter(x, y, z, c='r', marker='o')

    if control_points is not None:
        ax.plot(control_points[:,0], control_points[:,1], control_points[:,2], c='b', marker='o')

    if obstacles is not None:
        N = 100
        if obstacles["spheres"] is not None:
            u = np.linspace(0, 2*np.pi, N)
            v = np.linspace(0, np.pi, N)
            for obs in obstacles["spheres"].values():
                x = obs['xyz'][0]*np.ones(N) + obs['r']*np.outer(np.cos(u), np.sin(v))
                y = obs['xyz'][1]*np.ones(N) + obs['r']*np.outer(np.sin(u), np.sin(v))
                z = obs['xyz'][2]*np.ones(N) + obs['r']*np.outer(np.ones(N), np.cos(v))

                ax.plot_surface(x, y, z)

        if obstacles["cylinders"] is not None:            
            u = np.linspace(0, 2*np.pi, N)
            for obs in obstacles["cylinders"].values():
                z = np.linspace(obs["z"][0], obs["z"][1], N)
                u_grid, z_grid =np.meshgrid(u, z)
                x = obs['xy'][0] + obs['r']*np.cos(u_grid)
                y = obs['xy'][1] + obs['r']*np.sin(u_grid)
                
                ax.plot_surface(x, y, z_grid)

    if aspect == 'auto-adjusted':
        #ax.set_aspect('equal', 'box')
        plt.gca().set_aspect('equal')

    if save:
        plt.savefig(title)
    

def plot_final_vs_ref(X, X_ref=None, traject=None, floatingPlot=False, standardviews=False, views3D=[], views2D=[], x_ticks=None, y_ticks=None, z_ticks=None, labels=False, legendLoc='upper right', bbox=(1.1,1.1), pos=False, pos_ref=True, orient=True, orient_ref=False, control_points=None, obstacles=None, N_obs=500, title=None, filename='plot', directory=' ', B=2, H=3, reduc=50, reduc_ref=1, endpoint=True, xrange=None, yrange=None, zrange=None, aspect=None, plot=False, save=False, fontsize=12):
    if X.shape[0] < 3:
        raise Exception("Wrong dimensions of state matrix X: need at least (3,n), given {}".format(X.shape))
    X = np.array(X)

    if X_ref is not None:
        if X_ref.shape[0] < 3:
            raise Exception("Wrong dimensions of state matrix X_ref: need at least (3,n), given {}".format(X_ref.shape))
        X_ref = np.array(X_ref)


    if floatingPlot:
        B, H = 1, 4/9
        reduc_ref = 5
        tri = np.array([[-H/3, -H/3, 2/3*H], [B/2, -B/2, 0], [0, 0, 0]])
        fig = plt.figure()
        ax = fig.add_subplot(111, projection='3d')
        ax.set_facecolor('white')
        ax.xaxis.set_pane_color((1, 1, 1, 1))  # RGBA where 1, 1, 1 is white, and 1 is full opacity
        ax.yaxis.set_pane_color((1, 1, 1, 1))
        ax.zaxis.set_pane_color((1, 1, 1, 1))
        ax.grid(False)
        ax.set_axis_off()

        # Real state trajectory
        X_plotted = X[:3,0].reshape(1,-1)
        for i in range(len(X[0,:])):
            state = X[:,i]

            if i != 0:
                X_plotted = np.vstack((X_plotted, state[:3].reshape(1,-1)))

            if i%reduc == 0 or i == (len(X[0,:])-1)*(endpoint):
                # Position
                x, y, z = state[0], state[1], state[2]
                ax.scatter(x, y, z, c='r', marker='o')

                if orient:
                    if X.shape[0] < 6:
                        raise Exception("To represent orientation of X too, at least 6 rows are necessary")
                    # Oriented yellow tailsitter triangle
                    psi, phi, theta = state[3], state[4], state[5]

                        ## Point as column vector
                    traj_point = np.array([[x], [y], [z]])
                    R = np.dot(Rotz(psi) ,np.dot(Rotx(phi) ,Roty(theta)))
                    tri_rot = np.dot(R, tri) + np.tile(traj_point, (1,3))

                        ## Points of triangle as row vectors
                    tri_rot = tri_rot.T
                    verts = [list(tuple(_) for _ in tri_rot)]
                    
                    ax.add_collection3d(Poly3DCollection(verts, color='y', alpha=0.6))
        if pos:
            if labels:
                ax.plot(X_plotted[:,0], X_plotted[:,1], X_plotted[:,2], c='r', linestyle='dashed', alpha=0.6, label='Performed trajectory')
            else:
                ax.plot(X_plotted[:,0], X_plotted[:,1], X_plotted[:,2], c='r', linestyle='dashed', alpha=0.6)


        # Reference state trajectory
        if X_ref is not None:
            X_ref_plotted = X_ref[:3,0].reshape(1,-1)
            for i in range(len(X_ref[0,:])):
                if i%reduc_ref == 0 or i == (len(X_ref[0,:])-1)*(endpoint):
                    state = X_ref[:,i]
                    x, y, z = state[0], state[1], state[2]

                    if i != 0:
                        X_ref_plotted = np.vstack((X_ref_plotted, state[:3].reshape(1,-1)))
                    
                    # Position
                    if pos_ref:
                        ax.scatter(x, y, z, c='b', marker='o', alpha=0.8)

                    # Oriented yellow tailsitter triangle
                    if orient_ref:
                        if X_ref.shape[0] < 6:
                            raise Exception("To represent orientation of X_ref too, at least 6 rows are necessary")
                        psi, phi, theta = state[3], state[4], state[5]

                            ## Point as column vector
                        traj_point = np.array([[x], [y], [z]])
                        R = np.dot(Rotz(psi) ,np.dot(Rotx(phi) ,Roty(theta)))
                        tri_rot = np.dot(R, tri) + np.tile(traj_point, (1,3))

                            ## Points of triangle as row vectors
                        tri_rot = tri_rot.T
                        verts = [list(tuple(_) for _ in tri_rot)]
                        
                        ax.add_collection3d(Poly3DCollection(verts, facecolor=[(0.75,0.94,0.71)], edgecolor=[(0.40,0.55,0.15)], alpha=0.2))
            if pos_ref:
                if labels:
                    ax.plot(X_ref_plotted[:,0], X_ref_plotted[:,1], X_ref_plotted[:,2], c=(0.10,0.10,0.80), linestyle='dotted', label='Reference trajectory')
                else:
                    ax.plot(X_ref_plotted[:,0], X_ref_plotted[:,1], X_ref_plotted[:,2], c=(0.10,0.10,0.80), linestyle='dotted')

        # Control points
        if control_points is not None:
            if labels:
                ax.plot(control_points[:,0], control_points[:,1], control_points[:,2], c='b', marker='o', alpha=0.8, label='Control points')
            else:
                ax.plot(control_points[:,0], control_points[:,1], control_points[:,2], c='b', marker='o', alpha=0.8)

        # Obstacles
        if obstacles is not None:
            if obstacles["spheres"] is not None:
                u = np.linspace(0, 2*np.pi, N_obs)
                v = np.linspace(0, np.pi, N_obs)
                for obs in obstacles["spheres"].values():
                    x = obs['xyz'][0]*np.ones(N_obs) + obs['r']*np.outer(np.cos(u), np.sin(v))
                    y = obs['xyz'][1]*np.ones(N_obs) + obs['r']*np.outer(np.sin(u), np.sin(v))
                    z = obs['xyz'][2]*np.ones(N_obs) + obs['r']*np.outer(np.ones(N_obs), np.cos(v))

                    ax.plot_surface(x, y, z)

            if obstacles["cylinders"] is not None:            
                u = np.linspace(0, 2*np.pi, N_obs)
                for obs in obstacles["cylinders"].values():
                    z = np.linspace(obs["z"][0], obs["z"][1], N_obs)
                    u_grid, z_grid =np.meshgrid(u, z)
                    x = obs['xy'][0] + obs['r']*np.cos(u_grid)
                    y = obs['xy'][1] + obs['r']*np.sin(u_grid)
                    
                    ax.plot_surface(x, y, z_grid)
            ax.set_aspect('equal')
            plt.tight_layout()
            plt.show()

        return

    # Points of triangle as column vectors
    tri = np.array([[-H/3, -H/3, 2/3*H], [B/2, -B/2, 0], [0, 0, 0]])

    # Add standardview; fix directory in case the plot needs to be saved
    if standardviews:
        views3D = [(30,-60,0), (30,160,0)]
        views2D = [(90,-90,0), (0,90,0), (0,180,0)]

    views = views3D + views2D

    if directory.strip() == "":
        directory = os.getcwd()

    for view in views:
        # Figure
        fig = plt.figure()
        ax = fig.add_subplot(111, projection='3d')
        ax.set_xlabel('X')
        ax.set_ylabel('Y')
        ax.set_zlabel('Z')

        ax.set_facecolor('white')
        ax.xaxis.set_pane_color((1, 1, 1, 1))  # RGBA where 1, 1, 1 is white, and 1 is full opacity
        ax.yaxis.set_pane_color((1, 1, 1, 1))
        ax.zaxis.set_pane_color((1, 1, 1, 1))
        ax.xaxis._axinfo['grid'].update(color='#DCDCDC', alpha=0.8, linewidth=0.8)
        ax.yaxis._axinfo["grid"].update(color='#DCDCDC', alpha=0.8, linewidth=0.8)
        ax.zaxis._axinfo["grid"].update(color='#DCDCDC', alpha=0.8, linewidth=0.8)

        if xrange is not None:
            ax.set_xlim(xmin=xrange[0], xmax=xrange[1])
        if yrange is not None:
            ax.set_ylim(ymin=yrange[0], ymax=yrange[1])
        if zrange is not None:
            ax.set_zlim(zmin=zrange[0], zmax=zrange[1])        
        if title is not None:
            ax.set_title(title)

        # Real state trajectory
        X_plotted = X[:3,0].reshape(1,-1)
        for i in range(len(X[0,:])):
            state = X[:,i]

            if i != 0:
                X_plotted = np.vstack((X_plotted, state[:3].reshape(1,-1)))

            if i%reduc == 0 or i == (len(X[0,:])-1)*(endpoint):
                # Position
                x, y, z = state[0], state[1], state[2]
                ax.scatter(x, y, z, c='r', marker='o')

                if orient:
                    if X.shape[0] < 6:
                        raise Exception("To represent orientation of X too, at least 6 rows are necessary")
                    # Oriented yellow tailsitter triangle
                    psi, phi, theta = state[3], state[4], state[5]

                        ## Point as column vector
                    traj_point = np.array([[x], [y], [z]])
                    R = np.dot(Rotz(psi) ,np.dot(Rotx(phi) ,Roty(theta)))
                    tri_rot = np.dot(R, tri) + np.tile(traj_point, (1,3))

                        ## Points of triangle as row vectors
                    tri_rot = tri_rot.T
                    verts = [list(tuple(_) for _ in tri_rot)]
                    
                    ax.add_collection3d(Poly3DCollection(verts, color='y', alpha=0.6))
        if pos:
            if labels:
                ax.plot(X_plotted[:,0], X_plotted[:,1], X_plotted[:,2], c='r', linestyle='dashed', alpha=0.6, label='Performed trajectory')
            else:
                ax.plot(X_plotted[:,0], X_plotted[:,1], X_plotted[:,2], c='r', linestyle='dashed', alpha=0.6)


        # Reference state trajectory
        if X_ref is not None:
            X_ref_plotted = X_ref[:3,0].reshape(1,-1)
            for i in range(len(X_ref[0,:])):
                if i%reduc_ref == 0 or i == (len(X_ref[0,:])-1)*(endpoint):
                    state = X_ref[:,i]
                    x, y, z = state[0], state[1], state[2]

                    if i != 0:
                        X_ref_plotted = np.vstack((X_ref_plotted, state[:3].reshape(1,-1)))
                    
                    # Position
                    if pos_ref:
                        ax.scatter(x, y, z, c='b', marker='o', alpha=0.2)

                    # Oriented yellow tailsitter triangle
                    if orient_ref:
                        if X_ref.shape[0] < 6:
                            raise Exception("To represent orientation of X_ref too, at least 6 rows are necessary")
                        psi, phi, theta = state[3], state[4], state[5]

                            ## Point as column vector
                        traj_point = np.array([[x], [y], [z]])
                        R = np.dot(Rotz(psi) ,np.dot(Rotx(phi) ,Roty(theta)))
                        tri_rot = np.dot(R, tri) + np.tile(traj_point, (1,3))

                            ## Points of triangle as row vectors
                        tri_rot = tri_rot.T
                        verts = [list(tuple(_) for _ in tri_rot)]
                        
                        ax.add_collection3d(Poly3DCollection(verts, facecolor=[(0.75,0.94,0.71)], edgecolor=[(0.40,0.55,0.15)], alpha=0.2))
            if pos_ref:
                if labels:
                    ax.plot(X_ref_plotted[:,0], X_ref_plotted[:,1], X_ref_plotted[:,2], c=(0.10,0.10,0.80), linestyle='dotted', label='Reference trajectory')
                else:
                    ax.plot(X_ref_plotted[:,0], X_ref_plotted[:,1], X_ref_plotted[:,2], c=(0.10,0.10,0.80), linestyle='dotted')

        # Control points
        if control_points is not None:
            if labels:
                ax.plot(control_points[:,0], control_points[:,1], control_points[:,2], c='b', marker='o', alpha=0.8, label='Control points')
            else:
                ax.plot(control_points[:,0], control_points[:,1], control_points[:,2], c='b', marker='o', alpha=0.8)

        # Obstacles
        if obstacles is not None:
            if obstacles["spheres"] is not None:
                u = np.linspace(0, 2*np.pi, N_obs)
                v = np.linspace(0, np.pi, N_obs)
                for obs in obstacles["spheres"].values():
                    x = obs['xyz'][0]*np.ones(N_obs) + obs['r']*np.outer(np.cos(u), np.sin(v))
                    y = obs['xyz'][1]*np.ones(N_obs) + obs['r']*np.outer(np.sin(u), np.sin(v))
                    z = obs['xyz'][2]*np.ones(N_obs) + obs['r']*np.outer(np.ones(N_obs), np.cos(v))

                    ax.plot_surface(x, y, z)

            if obstacles["cylinders"] is not None:            
                u = np.linspace(0, 2*np.pi, N_obs)
                for obs in obstacles["cylinders"].values():
                    z = np.linspace(obs["z"][0], obs["z"][1], N_obs)
                    u_grid, z_grid =np.meshgrid(u, z)
                    x = obs['xy'][0] + obs['r']*np.cos(u_grid)
                    y = obs['xy'][1] + obs['r']*np.sin(u_grid)
                    
                    ax.plot_surface(x, y, z_grid)
            
        if labels:
            ax.legend(loc=legendLoc, bbox_to_anchor=bbox, fontsize=fontsize)

        if aspect == 'auto-adjusted':
            #plt.gca().set_aspect('equal')
            ax.set_aspect('equal')

        if x_ticks is None:
            x_ticks = ax.get_xticks()
        if y_ticks is None:
            y_ticks = ax.get_yticks()
        if z_ticks is None:
            z_ticks = ax.get_zticks()
    
    
        elev, azim, roll = view[0], view[1], view[2]
        ax.view_init(elev=elev, azim=azim, roll=roll) 

        ax.set_xticks(x_ticks)
        ax.set_yticks(y_ticks)
        ax.set_zticks(z_ticks)
        ax.xaxis.labelpad = 4
        ax.yaxis.labelpad = 4
        ax.zaxis.labelpad = 4
        
        planar = False

        if (elev%180 == 0) and (azim%180 == 0):
            ax.xaxis.set_visible(False)
            ax.set_xticks([])  # To ensure the axis ticks are also not visible
            #ax.xaxis.set_ticklabels([])
            ax.xaxis.label.set_visible(False) # Hide the axis label if necessary
            ax.yaxis.labelpad = 20
            #ax.legend().set_visible(False)
            ax.get_legend().remove()
            ax.set_aspect('equalyz')
            #ax.set_box_aspect([1e-15, current_aspect[1], current_aspect[2]])  Get rid of 3D perspective distortion
            print('X axis eliminated, aspect:   {}'.format(ax.get_aspect()))
            planar = True

        elif (elev%180 == 0) and ((azim-90)%180 == 0):
            ax.yaxis.set_visible(False)
            ax.set_yticks([])  # To ensure the axis ticks are also not visible
            #ax.yaxis.set_ticklabels([])
            ax.yaxis.label.set_visible(False) # Hide the axis label if necessary
            ax.xaxis.labelpad = 20
            if traject in ['ascending_turn', 'ascending_turn2', 'ascending_turn3']:
                ax.zaxis.labelpad = 15
            #ax.legend().set_visible(False)
            ax.get_legend().remove()
            ax.set_aspect('equalxz')
            #ax.set_box_aspect([current_aspect[0], 1e-15, current_aspect[2]])  #Get rid of 3D perspective distortion
            print('Y axis eliminated, aspect:   {}'.format(ax.get_aspect()))
            planar = True

        elif ((elev-90)%180 == 0):
            ax.zaxis.set_visible(False)
            ax.set_zticks([])  # To ensure the axis ticks are also not visible
            #ax.zaxis.set_ticklabels([])
            ax.zaxis.label.set_visible(False) # Hide the axis label if necessary
            if traject in ['ascending_turn', 'ascending_turn2', 'ascending_turn3']:
                ax.yaxis.labelpad = 20
            if traject in ['ClimbTurn', 'ClimbTurn2']:
                ax.xaxis.labelpad = 20
            #ax.legend().set_visible(False)
            ax.get_legend().remove()
            ax.set_aspect('equalxy')
            #ax.set_box_aspect([current_aspect[0], current_aspect[1], 1e-15])  Get rid of 3D perspective distortion
            print('Z axis eliminated, aspect:   {}'.format(ax.get_aspect()))
            planar = True
        
        if save:
            FN = filename + '__' + str(view)
            full_path = os.path.join(directory, FN)
            if planar == False:
                ax.set_aspect('equal')
            plt.tight_layout()
            plt.savefig(full_path, dpi=1200)
            print('Image saved')

        # If plot needs to be showed
        if plot:
            plt.tight_layout()
            plt.show()

